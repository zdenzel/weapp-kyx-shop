"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,a){try{var i=e[o](a),u=i.value}catch(t){return void n(t)}if(!i.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}return r("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _lodash=require("./../../npm/lodash/lodash.js"),_lodash2=_interopRequireDefault(_lodash),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_utils=require("./../../utils/index.js"),_utils2=_interopRequireDefault(_utils),_api=require("./../../utils/api.js"),_api2=_interopRequireDefault(_api),_postcomment=require("./postcomment.js"),_postcomment2=_interopRequireDefault(_postcomment),devWidth=750,winWidth=_wepy2.default.getSystemInfoSync().windowWidth,winRatio=winWidth/devWidth,OrderItems=function(t){function e(){var t,n,r,o;_classCallCheck(this,e);for(var a=arguments.length,i=Array(a),u=0;u<a;u++)i[u]=arguments[u];return n=r=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),r.$repeat={},r.$props={postcomment:{"xmlns:v-bind":"","v-bind:order.sync":"orderObj","xmlns:v-on":""}},r.$events={postcomment:{"v-on:on-submit":"onSubmitComment"}},r.components={postcomment:_postcomment2.default},r.props={datalist:{type:Array,default:null,twoWay:!1}},r.data={orderObj:null},r.computed={optimize:function(){var t=Math.ceil(180*winRatio);return t+"x"+t}},r.methods={tapOrderCancel:function(t){var e=this,n={id:t};_wepy2.default.showModal({title:"温馨提示",content:"请确认要取消该订单吗？"}).then(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!o.confirm){r.next=6;break}return _wepy2.default.showLoading(),r.next=4,_utils2.default.request(_api2.default.order.cancel,{data:n}).then(function(n){try{e.datalist=e.datalist.map(function(e){return e.id==t&&(e.status=5),e})}catch(t){}}).catch(function(t){_wepy2.default.showModal({title:"温馨提示",content:t.message,showCancel:!1})});case 4:_wepy2.default.hideLoading(),e.$apply();case 6:case"end":return r.stop()}},r,e)}));return function(t){return r.apply(this,arguments)}}())},tapOrderPayment:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:e.id},_wepy2.default.showLoading(),t.next=4,_utils2.default.request(_api2.default.payment,{data:n}).then(function(t){var n=t.result;_wepy2.default.requestPayment({timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,complete:function(t){},success:function(t){_wepy2.default.navigateTo({url:"/pages/order/result?id="+e.id+"&status=success&price="+e.totalAmount})},fail:function(t){}})}).catch(function(t){_wepy2.default.showModal({title:"温馨提示",content:t.message,showCancel:!1})});case 4:_wepy2.default.hideLoading();case 5:case"end":return t.stop()}},t,this)}));return t}(),tapOrderConfirm:function(t){var e=this,n={id:t};_wepy2.default.showModal({title:"温馨提示",content:"请确认收到货物后进行此操作"}).then(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!o.confirm){r.next=6;break}return _wepy2.default.showLoading(),r.next=4,_utils2.default.request(_api2.default.order.confirm,{data:n}).then(function(n){try{e.datalist=e.datalist.map(function(e){return e.id==t&&(e.status=4),e})}catch(t){}}).catch(function(t){_wepy2.default.showModal({title:"温馨提示",content:t.message,showCancel:!1})});case 4:_wepy2.default.hideLoading(),e.$apply();case 6:case"end":return r.stop()}},r,e)}));return function(t){return r.apply(this,arguments)}}())},tapOrderComment:function(t){this.orderObj=t,this.$broadcast("showPostComment",t)},onSubmitComment:function(t){this.datalist.map(function(e){return e.id==t.id&&(e.isCommented=1),e}),this.$apply()}},o=n,_possibleConstructorReturn(r,o)}return _inherits(e,t),e}(_wepy2.default.component);exports.default=OrderItems;