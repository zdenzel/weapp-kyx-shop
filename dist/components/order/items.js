"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _lodash=require("./../../npm/lodash/lodash.js"),_lodash2=_interopRequireDefault(_lodash),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_utils=require("./../../utils/index.js"),_utils2=_interopRequireDefault(_utils),_api=require("./../../utils/api.js"),_api2=_interopRequireDefault(_api),_postcomment=require("./postcomment.js"),_postcomment2=_interopRequireDefault(_postcomment),devWidth=750,winWidth=_wepy2.default.getSystemInfoSync().windowWidth,winRatio=winWidth/devWidth,OrderItems=function(e){function t(){var e,n,r,o;_classCallCheck(this,t);for(var a=arguments.length,i=Array(a),u=0;u<a;u++)i[u]=arguments[u];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.$repeat={},r.$props={postcomment:{"xmlns:v-bind":"","v-bind:order.sync":"orderObj","xmlns:v-on":""}},r.$events={postcomment:{"v-on:on-submit":"onSubmitComment"}},r.components={postcomment:_postcomment2.default},r.props={datalist:{type:Array,default:null,twoWay:!1}},r.data={orderObj:null},r.computed={optimize:function(){var e=Math.ceil(180*winRatio);return e+"x"+e}},r.methods={tapOrderCancel:function(e){var t=this,n={id:e};_wepy2.default.showModal({title:"温馨提示",content:"请确认要取消该订单吗？"}).then(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!o.confirm){r.next=6;break}return _wepy2.default.showLoading(),r.next=4,_utils2.default.request(_api2.default.order.cancel,{data:n}).then(function(n){try{t.datalist=t.datalist.map(function(t){return t.id==e&&(t.status=5),t})}catch(e){}}).catch(function(e){_wepy2.default.showModal({title:"温馨提示",content:e.message,showCancel:!1})});case 4:_wepy2.default.hideLoading(),t.$apply();case 6:case"end":return r.stop()}},r,t)}));return function(e){return r.apply(this,arguments)}}())},tapOrderPayment:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t.id},_wepy2.default.showLoading(),e.next=4,_utils2.default.request(_api2.default.payment,{data:n}).then(function(e){var n=e.result;_wepy2.default.requestPayment({timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,complete:function(e){console.log("complete",e)},success:function(e){console.log("success",e),_wepy2.default.navigateTo({url:"/pages/order/result?id="+t.id+"&status=success&price="+t.totalAmount})},fail:function(e){console.log("fail",e)}})}).catch(function(e){_wepy2.default.showModal({title:"温馨提示",content:e.message,showCancel:!1})});case 4:_wepy2.default.hideLoading();case 5:case"end":return e.stop()}},e,this)}));return e}(),tapOrderConfirm:function(e){var t=this,n={id:e};_wepy2.default.showModal({title:"温馨提示",content:"请确认收到货物后进行此操作"}).then(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!o.confirm){r.next=6;break}return _wepy2.default.showLoading(),r.next=4,_utils2.default.request(_api2.default.order.confirm,{data:n}).then(function(n){try{t.datalist=t.datalist.map(function(t){return t.id==e&&(t.status=4),t})}catch(e){}}).catch(function(e){_wepy2.default.showModal({title:"温馨提示",content:e.message,showCancel:!1})});case 4:_wepy2.default.hideLoading(),t.$apply();case 6:case"end":return r.stop()}},r,t)}));return function(e){return r.apply(this,arguments)}}())},tapOrderComment:function(e){this.orderObj=e,this.$broadcast("showPostComment",e)},onSubmitComment:function(e){this.datalist.map(function(t){return t.id==e.id&&(t.isCommented=1),t}),this.$apply()}},o=n,_possibleConstructorReturn(r,o)}return _inherits(t,e),t}(_wepy2.default.component);exports.default=OrderItems;