"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,u){try{var i=t[o](u),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.delShopBuyConsignee=exports.getShopBuyConsignee=exports.setShopBuyConsignee=exports.delShopBuyList=exports.getShopBuyList=exports.setShopBuyList=exports.checkShopCartAll=exports.checkShopCartOne=exports.setShopCart=exports.delShopCart=exports.addShopCart=exports.getShopCart=void 0;var _wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_reduxActions=require("./../../npm/redux-actions/lib/index.js"),_shopcart=require("./../types/shopcart.js"),_shopcart2=_interopRequireDefault(_shopcart),_utils=require("./../../utils/index.js"),_utils2=_interopRequireDefault(_utils),_api=require("./../../utils/api.js"),_api2=_interopRequireDefault(_api),getShopCart=exports.getShopCart=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_CART_LIST,function(e){return new Promise(function(e){var t=Array.from(new Set(_wepy2.default.getStorageSync(_shopcart2.default.SHOP_CART_LIST)||[])),n=Array.from(new Set(t.filter(function(e){return e.uid==_wepy2.default.$instance.globalData.uid}))),r={data:n.map(function(e){return{id:e.id,sid:e.sid,type:e.type}})};_utils2.default.request(_api2.default.shopcart.infos,{data:r,method:"post"}).then(function(n){var r=n.result;try{t=t.map(function(e){var t=Object.assign({notice:null},e),n=r.findIndex(function(t){return t.id==e.id}),o=Object.assign({},r[n]),u=[];return o.stock||u.push("没有库存"),n>-1&&(t=Object.assign({},t,o,{count:o.stock>t.count?t.count:o.stock,notice:u?u.join("，"):null,isSelected:!(!o.stock||!t.count)&&t.isSelected})),t})}catch(e){}e(t)}).catch(function(e){})})}),addShopCart=exports.addShopCart=(0,_reduxActions.createAction)(_shopcart2.default.ADD_SHOP_CART_LIST,function(e){return new Promise(function(t){t(e)})}),delShopCart=exports.delShopCart=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_CART_LIST,function(e){return new Promise(function(t){t(e)})}),setShopCart=exports.setShopCart=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_CART_LIST,function(e){return new Promise(function(t){t(e)})}),checkShopCartOne=exports.checkShopCartOne=(0,_reduxActions.createAction)(_shopcart2.default.CHECK_SHOP_CART_ONE,function(e){return new Promise(function(t){t(e)})}),checkShopCartAll=exports.checkShopCartAll=(0,_reduxActions.createAction)(_shopcart2.default.CHECK_SHOP_CART_ALL,function(e){return new Promise(function(t){t(e)})}),setShopBuyList=exports.setShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_BUY_LIST,function(e){return new Promise(function(t){t(e)})}),getShopBuyList=exports.getShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_BUY_LIST,function(e){return new Promise(function(t){t(e)})}),delShopBuyList=exports.delShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_BUY_LIST,function(e){return new Promise(function(t){t(e)})}),setShopBuyConsignee=exports.setShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_BUY_CONSIGNEE,function(e){return new Promise(function(t){_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,e),t(e)})}),getShopBuyConsignee=exports.getShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_BUY_CONSIGNEE,function(e){return new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_wepy2.default.getStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE)||null){e.next=4;break}return e.next=4,_utils2.default.request(_api2.default.consignee.default).then(function(e){var t=e.result;n=t}).catch(function(e){});case 4:_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,n),t(n);case 6:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())}),delShopBuyConsignee=exports.delShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_BUY_CONSIGNEE,function(e){return new Promise(function(t){_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,null),t(e)})});