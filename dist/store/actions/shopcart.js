"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var u=e[o](i),s=u.value}catch(t){return void n(t)}if(!u.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}return r("next")})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.delShopBuyConsignee=exports.getShopBuyConsignee=exports.setShopBuyConsignee=exports.delShopBuyList=exports.getShopBuyList=exports.setShopBuyList=exports.checkShopCartAll=exports.checkShopCartOne=exports.setShopCartList=exports.delShopCartList=exports.addShopCartList=exports.getShopCartList=void 0;var _wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_reduxActions=require("./../../npm/redux-actions/lib/index.js"),_shopcart=require("./../types/shopcart.js"),_shopcart2=_interopRequireDefault(_shopcart),_utils=require("./../../utils/index.js"),_utils2=_interopRequireDefault(_utils),_api=require("./../../utils/api.js"),_api2=_interopRequireDefault(_api),getShopCartList=exports.getShopCartList=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_CART_LIST,function(t){return new Promise(function(t){var e=Array.from(new Set(_wepy2.default.getStorageSync(_shopcart2.default.SHOP_CART_LIST)||[])),n=Array.from(new Set(e.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}))),r={data:n.map(function(t){return{id:t.id,sid:t.sid,type:t.type}})};_utils2.default.request(_api2.default.shopcart.infos,{data:r,method:"post"}).then(function(n){var r=n.result;try{e=e.map(function(t){var e=Object.assign({notice:null},t),n=r.findIndex(function(e){return e.id==t.id}),o=Object.assign({},r[n]),i=[];return o.stock||i.push("没有库存"),n>-1&&(e=Object.assign({},e,o,{count:o.stock>e.count?e.count:o.stock,notice:i?i.join("，"):null,isSelected:!(!o.stock||!e.count)&&e.isSelected})),e})}catch(t){}t(e)}).catch(function(t){})})}),addShopCartList=exports.addShopCartList=(0,_reduxActions.createAction)(_shopcart2.default.ADD_SHOP_CART_LIST,function(t){return new Promise(function(e){e(t)})}),delShopCartList=exports.delShopCartList=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_CART_LIST,function(t){return new Promise(function(e){e(t)})}),setShopCartList=exports.setShopCartList=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_CART_LIST,function(t){return new Promise(function(e){e(t)})}),checkShopCartOne=exports.checkShopCartOne=(0,_reduxActions.createAction)(_shopcart2.default.CHECK_SHOP_CART_ONE,function(t){return new Promise(function(e){e(t)})}),checkShopCartAll=exports.checkShopCartAll=(0,_reduxActions.createAction)(_shopcart2.default.CHECK_SHOP_CART_ALL,function(t){return new Promise(function(e){e(t)})}),setShopBuyList=exports.setShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_BUY_LIST,function(t){return new Promise(function(e){e(t)})}),getShopBuyList=exports.getShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_BUY_LIST,function(t){return new Promise(function(e){e(t)})}),delShopBuyList=exports.delShopBuyList=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_BUY_LIST,function(t){return new Promise(function(e){e(t)})}),setShopBuyConsignee=exports.setShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.SET_SHOP_BUY_CONSIGNEE,function(t){return new Promise(function(e){_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,t),e(t)})}),getShopBuyConsignee=exports.getShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.GET_SHOP_BUY_CONSIGNEE,function(t){return new Promise(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=_wepy2.default.getStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE)||null){t.next=4;break}return t.next=4,_utils2.default.request(_api2.default.consignee.default).then(function(t){var e=t.result;n=e}).catch(function(t){});case 4:_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,n),e(n);case 6:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}())}),delShopBuyConsignee=exports.delShopBuyConsignee=(0,_reduxActions.createAction)(_shopcart2.default.DEL_SHOP_BUY_CONSIGNEE,function(t){return new Promise(function(e){_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_CONSIGNEE,null),e(t)})});