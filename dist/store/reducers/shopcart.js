"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(exports,"__esModule",{value:!0});var _handleActions,_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},_lodash=require("./../../npm/lodash/lodash.js"),_lodash2=_interopRequireDefault(_lodash),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_reduxActions=require("./../../npm/redux-actions/lib/index.js"),_shopcart=require("./../types/shopcart.js"),_shopcart2=_interopRequireDefault(_shopcart),initState={shopCartData:[],shopCartList:[],shopBuyList:[],shopBuyConsignee:null,shopBuyType:1,isSelectedAll:!1,totalAmount:0,shopCartCount:0},getSelectStatus=function(t){try{return t.every(function(t){return 1==t.isSelected})}catch(t){}},getTotalAmount=function(t){try{var e=0;return t.forEach(function(t){var a=NaN!=Number(t.price)?Number(t.price):0,n=NaN!=Number(t.count)?Number(t.count):0;t.isSelected&&(e+=a*n)}),e.toFixed(2)}catch(t){}},reducers=(0,_reduxActions.handleActions)((_handleActions={},_defineProperty(_handleActions,_shopcart2.default.GET_SHOP_CART_LIST,function(t,e){var a=(e.type,e.payload),n=Array.from(new Set(a||[])),o=Array.from(new Set(n.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}))),r=getSelectStatus(o),u=getTotalAmount(o),s=o.length;return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,n),_extends({},t,{shopCartData:n,shopCartList:o,isSelectedAll:r,totalAmount:u,shopCartCount:s})}),_defineProperty(_handleActions,_shopcart2.default.SET_SHOP_CART_LIST,function(t,e){var a=(e.type,e.payload),n=t.shopCartData.concat(),o=Object.assign({},a||{});try{n=n.map(function(t){return t.uid==_wepy2.default.$instance.globalData.uid&&t.id==a.id&&t.sid==a.sid&&(t=Object.assign({},o,{isSelected:!!o.count})),t})}catch(t){}var r=n.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}),u=getSelectStatus(r),s=getTotalAmount(r),i=r.length;return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,n),_extends({},t,{shopCartData:n,shopCartList:r,isSelectedAll:u,totalAmount:s,shopCartCount:i})}),_defineProperty(_handleActions,_shopcart2.default.DEL_SHOP_CART_LIST,function(t,e){var a=(e.type,e.payload),n=t.shopCartData.concat();try{var o=n.findIndex(function(t){return t.id==a.id&&t.uid==_wepy2.default.$instance.globalData.uid&&t.sid==a.sid});n.splice(o,1)}catch(t){}var r=n.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}),u=getSelectStatus(r),s=getTotalAmount(r),i=r.length;return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,n),_extends({},t,{shopCartData:n,shopCartList:r,isSelectedAll:u,totalAmount:s,shopCartCount:i})}),_defineProperty(_handleActions,_shopcart2.default.ADD_SHOP_CART_LIST,function(t,e){var a=(e.type,e.payload),n=t.shopCartData.concat();try{if(a.constructor==Object){n.find(function(t){return t.id==a.id&&t.uid==_wepy2.default.$instance.globalData.uid&&t.sid==a.sid})?n=n.map(function(t){if(t.id==a.id&&t.uid==_wepy2.default.$instance.globalData.uid&&t.sid==a.sid){t.isSelected=!0;var e=t.count+a.count;t.count=t.stock>e?e:t.stock}return t}):n.push(Object.assign({},a,{isSelected:!0}))}}catch(t){}var o=n.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}),r=getSelectStatus(o),u=getTotalAmount(o),s=o.length;return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,n),_extends({},t,{shopCartData:n,shopCartList:o,isSelectedAll:r,totalAmount:u,shopCartCount:s})}),_defineProperty(_handleActions,_shopcart2.default.CHECK_SHOP_CART_ONE,function(t,e){var a=(e.type,e.payload),n=t.shopCartData.concat();try{n=n.map(function(t){return t.uid==_wepy2.default.$instance.globalData.uid&&t.id==a.id&&t.sid==a.sid&&(t.isSelected=!t.isSelected),t})}catch(t){}var o=n.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}),r=getSelectStatus(o),u=getTotalAmount(o);return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,n),_extends({},t,{shopCartData:n,shopCartList:o,isSelectedAll:r,totalAmount:u})}),_defineProperty(_handleActions,_shopcart2.default.CHECK_SHOP_CART_ALL,function(t,e){var a=(e.type,e.payload,t.shopCartData.concat()),n=!t.isSelectedAll;try{a=a.map(function(t){return t.stock&&t.uid==_wepy2.default.$instance.globalData.uid&&(t.isSelected=n),t})}catch(t){}var o=a.filter(function(t){return t.uid==_wepy2.default.$instance.globalData.uid}),r=getTotalAmount(o);return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:o,isSelectedAll:n,totalAmount:r})}),_defineProperty(_handleActions,_shopcart2.default.SET_SHOP_BUY_LIST,function(t,e){var a=(e.type,e.payload),n=t.shopBuyList.concat(),o=t.shopBuyType;if(a)return a.constructor==Object?(n=[Object.assign({},a,{isSelected:!0})],o=3==a.type?2:1):a.constructor==Array&&(n=a.map(function(t){return t.isSelected=!0,t}),o=3==n[0].type?2:1),_wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_LIST,n),_extends({},t,_defineProperty({shopBuyList:n},"shopBuyList",n));var r=t.shopCartList.concat();try{n=r.filter(function(t){return t.isSelected}),o=3==n[0].type?2:1}catch(t){}return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_LIST,n),_extends({},t,{shopBuyList:n,shopBuyType:o})}),_defineProperty(_handleActions,_shopcart2.default.GET_SHOP_BUY_LIST,function(t,e){var a=(e.type,e.payload,_wepy2.default.getStorageSync(_shopcart2.default.SHOP_BUY_LIST)||t.shopBuyList.concat()),n=getTotalAmount(a),o=3==a[0].type?2:1;return _extends({},t,{totalAmount:n,shopBuyList:a,shopBuyType:o})}),_defineProperty(_handleActions,_shopcart2.default.DEL_SHOP_BUY_LIST,function(t,e){var a=(e.type,e.payload,[]);return _wepy2.default.setStorageSync(_shopcart2.default.SHOP_BUY_LIST,a),_extends({},t,{shopBuyList:a,shopBuyType:1})}),_defineProperty(_handleActions,_shopcart2.default.SET_SHOP_BUY_CONSIGNEE,function(t,e){var a=(e.type,e.payload),n=Object.assign({},a);return _extends({},t,{shopBuyConsignee:n})}),_defineProperty(_handleActions,_shopcart2.default.GET_SHOP_BUY_CONSIGNEE,function(t,e){var a=(e.type,e.payload),n=Object.assign({},a);return _extends({},t,{shopBuyConsignee:n})}),_defineProperty(_handleActions,_shopcart2.default.DEL_SHOP_BUY_CONSIGNEE,function(t,e){e.type,e.payload;return _extends({},t,{shopBuyConsignee:null})}),_handleActions),initState);exports.default=reducers;